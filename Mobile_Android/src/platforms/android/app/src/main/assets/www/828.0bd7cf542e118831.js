"use strict";(self.webpackChunkmoneyguard=self.webpackChunkmoneyguard||[]).push([[828],{828:(k,_,a)=>{a.r(_),a.d(_,{AnualModule:()=>z});var C=a(7612),d=a(9808),u=a(1787),g=a(5861),h=a(3905),T=a(8982),p=a(263),t=a(5e3),y=a(232),Z=a(4832),M=a(7261),S=a(8966),Y=a(4455),v=a(4218),O=a(3441),D=a(773),f=a(7322),I=a(4107),N=a(2181),m=a(1125),x=a(508),A=a(4623);function F(o,s){1&o&&(t.TgZ(0,"div",2),t._UZ(1,"mat-spinner",3),t.qZA())}function E(o,s){if(1&o&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&o){const e=s.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function B(o,s){1&o&&t._UZ(0,"mat-spinner",2)}function J(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"mat-list-item"),t.TgZ(1,"div",18),t.TgZ(2,"p",19),t.NdJ("click",function(){const r=t.CHM(e).$implicit,l=t.oxw(2).$implicit;return t.oxw(2).goToMonth(r.month,l.description)}),t._uU(3),t.qZA(),t.TgZ(4,"p",20),t.NdJ("click",function(){const r=t.CHM(e).$implicit,l=t.oxw(2).$implicit;return t.oxw(2).goToMonth(r.month,l.description)}),t._uU(5),t.ALo(6,"currency"),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=s.$implicit,n=t.oxw(4);t.xp6(3),t.hij(" ",e.MonthFormatted," "),t.xp6(1),t.ekj("importeNegativo",e.balance<0),t.xp6(1),t.Oqu(t.xi3(6,4,e.balance,n._userService.userCurrency))}}function P(o,s){if(1&o&&(t.TgZ(0,"mat-list"),t.YNc(1,J,7,7,"mat-list-item",17),t.qZA()),2&o){const e=t.oxw(3);t.xp6(1),t.Q6J("ngForOf",e.itemDetail)}}function U(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"mat-expansion-panel",15),t.NdJ("opened",function(){const r=t.CHM(e).$implicit;return t.oxw(2).loadYearDetails(r)}),t.TgZ(1,"mat-expansion-panel-header"),t.TgZ(2,"mat-panel-title",16),t._uU(3),t.qZA(),t.TgZ(4,"mat-panel-description"),t._uU(5),t.ALo(6,"currency"),t.qZA(),t.qZA(),t.YNc(7,B,1,0,"mat-spinner",0),t.YNc(8,P,2,1,"mat-list",1),t.qZA()}if(2&o){const e=s.$implicit,n=t.oxw(2);t.Q6J("expanded",!n.loading&&e.description===n.openItem),t.xp6(2),t.s9C("id","item"+e.description),t.xp6(1),t.hij(" ",e.description," "),t.xp6(1),t.ekj("importeNegativo",e.balance<0),t.xp6(1),t.hij(" ",t.xi3(6,8,e.balance,n._userService.userCurrency)," "),t.xp6(2),t.Q6J("ngIf",n.loadingDetail),t.xp6(1),t.Q6J("ngIf",!n.loadingDetail)}}function w(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"div",4),t.TgZ(2,"div",5),t.TgZ(3,"mat-form-field",6),t.TgZ(4,"mat-label"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"mat-select",7),t.NdJ("valueChange",function(i){return t.CHM(e),t.oxw().anioSelected=i})("selectionChange",function(){return t.CHM(e),t.oxw().onChangeYear()}),t.YNc(8,E,2,2,"mat-option",8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",9),t.TgZ(10,"app-saldo",10),t.NdJ("saldoClicked",function(){return t.CHM(e),t.oxw().showOpenSaldo()}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"div",11),t.TgZ(12,"mat-accordion",12),t.YNc(13,U,9,11,"mat-expansion-panel",13),t.qZA(),t.qZA(),t.qZA()}if(2&o){const e=t.oxw();t.xp6(5),t.Oqu(t.lcZ(6,6,"yearScreen.year")),t.xp6(2),t.Q6J("value",e.anioSelected),t.xp6(1),t.Q6J("ngForOf",e.anios),t.xp6(2),t.Q6J("titulo",e.saldoTitle)("saldo",e.saldoAnual),t.xp6(3),t.Q6J("ngForOf",e.conceptosTotales)}}const b=[{path:":anio/:open",component:(()=>{class o{constructor(e,n,i,r,l,c,H,L,Q,j,R){this._datePipe=e,this._diarioService=n,this._userService=i,this.snackBar=r,this.saldoAbierto=l,this.calculationService=c,this.router=H,this.changeDetector=L,this.activeRoute=Q,this.translate=j,this._helperService=R,this.anios=new Array,this.loading=!1,this.loadingDetail=!1,this.saldoAnual=0,this.anioSelected=this.getYearFromUrl()}get saldoTitle(){return this.translate.instant("yearScreen.yearBalance")}ngOnInit(){this.getPrimerConsumo()}ngAfterViewChecked(){this.changeDetector.detectChanges()}getPrimerConsumo(){var e=this;return(0,g.Z)(function*(){e.loading=!0;const n=yield e._diarioService.getPrimerConsumo();try{const i=yield(0,h.z)(n),r=Number(i.firstTransaction.substring(0,4));for(let c=Number(i.lastTransaction.substring(0,4));c>=r;c--)e.anios.push(c);e.getData()}catch(i){e.loading=!1,e._helperService.showSnackBarError(e.snackBar,e._helperService.getErrorMessage(i))}})()}showOpenSaldo(){const e=[],n={title:"A\xf1o"+this._helperService.toCamelCase(this._datePipe.transform(new Date(this.anioSelected,1,1),"yyyy")),icon:"airplay",ingresos:this.getIngresos(),egresos:this.getEgresos(),concept:"anual",date:new Date(this.anioSelected,1,1)};e.push(n),this.saldoAbierto.open(T.G,{width:"500px",data:{saldos:e}})}loadYearDetails(e){var n=this;return(0,g.Z)(function*(){n.loadingDetail=!0,n.openItem=e.description,n.itemDetail=[];const i=n._diarioService.getConceptosMovimAnio(e.conceptId,n.anioSelected);try{const r=yield(0,h.z)(i);n.itemDetail=r,n.itemDetail.forEach(l=>{const c=n._helperService.convertStringMMYYYYToDate(l.month);l.MonthFormatted=n._helperService.toCamelCase(n._datePipe.transform(c,"LLLL yyyy"))}),n.loadingDetail=!1,n.router.navigate([p.r.DASHBOARD,p.r.ANUAL,n.anioSelected,n.openItem],{replaceUrl:!1})}catch(r){n.loading=!1,n._helperService.showSnackBarError(n.snackBar,n._helperService.getErrorMessage(r))}})()}onChangeYear(){this.router.navigate([p.r.DASHBOARD,p.r.ANUAL,this.anioSelected,this.openItem],{replaceUrl:!1}),this.getData()}goToMonth(e,n){const i=this.convertMMYYYYToYYYYMM(e);this.router.navigate([p.r.DASHBOARD,p.r.MENSUAL,i,n])}getOpenItem(){return this.activeRoute.snapshot.paramMap.get("open")}scrollToItem(e){setTimeout(function(n){if("none"===n)return;const i=document.getElementById("item"+n);if(null===i)return;i.scrollIntoView({block:"start",behavior:"auto"});const r=document.getElementById("mainTable");null!==r&&(r.scrollTop=r.scrollTop-30)},1,e)}convertToNumberArray(e){if(void 0!==e){const n=[];return e.forEach(function(i){n.push(i.balance)}),n}return[]}getYearFromUrl(){const e=this.activeRoute.snapshot.paramMap.get("anio");return Number(e)}getIngresos(){return this.calculationService.getIngresos(this.convertToNumberArray(this.conceptosTotales))}getEgresos(){return this.calculationService.getEgresos(this.convertToNumberArray(this.conceptosTotales))}getData(){var e=this;return(0,g.Z)(function*(){var n;e.loading=!0;const i=e._diarioService.getConceptosTotalAnio(e.anioSelected);try{const r=yield(0,h.z)(i);e.conceptosTotales=r,e.saldoAnual=e.getIngresos()-e.getEgresos(),e.loading=!1,e.openItem=null!==(n=e.getOpenItem())&&void 0!==n?n:"",e.scrollToItem(e.openItem)}catch(r){e.loading=!1,e._helperService.showSnackBarError(e.snackBar,e._helperService.getErrorMessage(r))}})()}convertMMYYYYToYYYYMM(e){return e.substring(2,8)+"-"+e.substring(0,2)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(d.uU),t.Y36(y.C),t.Y36(Z.f),t.Y36(M.ux),t.Y36(S.uw),t.Y36(Y.H),t.Y36(u.F0),t.Y36(t.sBO),t.Y36(u.gz),t.Y36(v.sK),t.Y36(O.W))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-anual"]],decls:2,vars:2,consts:[["class","loading",4,"ngIf"],[4,"ngIf"],[1,"loading"],["diameter","70","strokeWidth","5"],[1,"header"],[1,"column"],[1,"anioSelect"],[3,"value","valueChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[1,"column","saldos"],[3,"titulo","saldo","saldoClicked"],["id","mainTable",1,"tableContent"],[1,"conceptos-table"],[3,"expanded","opened",4,"ngFor","ngForOf"],[3,"value"],[3,"expanded","opened"],[3,"id"],[4,"ngFor","ngForOf"],["matLine",""],[1,"itemDescription",3,"click"],[1,"itemAmount",3,"click"]],template:function(e,n){1&e&&(t.YNc(0,F,2,0,"div",0),t.YNc(1,w,14,8,"div",1)),2&e&&(t.Q6J("ngIf",n.loading),t.xp6(1),t.Q6J("ngIf",!n.loading))},directives:[d.O5,D.$g,f.KE,f.hX,I.gD,d.sg,N.q,m.pp,x.ey,m.ib,m.yz,m.yK,m.u4,A.i$,A.Tg,x.X2],pipes:[v.X$,d.H9],styles:[".header[_ngcontent-%COMP%]{display:table;margin:0 auto;clear:both;width:60%;text-align:center}.column[_ngcontent-%COMP%]{float:left;width:50%}.saldos[_ngcontent-%COMP%]{margin-top:15px}.anioSelect[_ngcontent-%COMP%]{width:100px;margin-left:5px;margin-top:10px}.tableContent[_ngcontent-%COMP%]{display:flex;justify-content:center;position:fixed;width:100%;height:84%;top:16%;overflow-y:scroll;max-block-size:-webkit-fill-available}.conceptos-table[_ngcontent-%COMP%]{width:60%}.mat-expansion-panel-header-description[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.itemDescription[_ngcontent-%COMP%]{float:left;font-size:small}.itemAmount[_ngcontent-%COMP%]{float:right;font-size:small}@media only screen and (max-width: 600px){.conceptos-table[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]{width:100%}}"]}),o})()}];let $=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[u.Bz.forChild(b)],u.Bz]}),o})(),z=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[[d.ez,C.m,$,v.aw]]}),o})()}}]);
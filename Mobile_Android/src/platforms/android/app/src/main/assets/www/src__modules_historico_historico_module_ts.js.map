{"version":3,"file":"src__modules_historico_historico_module_ts.js","mappings":"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","sources":["./src/_components/historico/historico.component.ts","./src/_components/historico/historico.component.html","./src/_modules/historico/historico-routing.module.ts","./src/_modules/historico/historico.module.ts"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { DiarioService } from '../../services/diario.service';\nimport { UsersService } from '../../services/users.service';\nimport { HelperService } from '../../services/helper.service';\nimport { CalculationService } from '../../sharedServices/calculationService';\nimport { firstValueFrom } from 'rxjs';\nimport { ISaldoItem } from '../../models/saldoItem';\nimport { SaldoAbiertoComponent } from '../saldo-abierto/saldo-abierto.component';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { MatDialog } from '@angular/material/dialog';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'app-historico',\n  templateUrl: './historico.component.html',\n  styleUrls: ['./historico.component.css']\n})\nexport class HistoricoComponent implements OnInit {\n  conceptosTotales: any[];\n  itemDetail: any[];\n  loading = false;\n  loadingDetail = false;\n  saldoActual = 0;\n\n  get historicalBalanceTitle(): string {\n    return this.translate.instant('historical.balance');\n  }\n\n  constructor(private _diarioService: DiarioService,\n              public _userService: UsersService,\n              private calculationService: CalculationService,\n              public snackBar: MatSnackBar,\n              public saldoAbierto: MatDialog,\n              public translate: TranslateService,\n              private _helperService: HelperService) {\n  }\n\n  ngOnInit() {\n    this.getData();\n  }\n\n  private getIngresos(): number {\n    return this.calculationService.getIngresos(this.convertToNumberArray(this.conceptosTotales));\n  }\n\n  private getEgresos(): number {\n    return this.calculationService.getEgresos(this.convertToNumberArray(this.conceptosTotales));\n  }\n\n  async getData(): Promise<void> {\n    this.loading = true;\n\n    const source$ = this._diarioService.getConceptosTotalHistorico();\n\n    try {\n      const data = await firstValueFrom(source$);\n\n      this.conceptosTotales = data;\n      this.saldoActual = this.getIngresos() - this.getEgresos();\n      this.loading = false;\n\n    } catch (error) {\n      this.loading = false;\n      this._helperService.showSnackBarError(this.snackBar, this._helperService.getErrorMessage(error));\n    }\n  }\n\n  private convertToNumberArray(dataIn: any[]): number[] {\n    if (dataIn !== undefined) {\n      const importes: number[] = [];\n      dataIn.forEach(function (value) {\n        importes.push(value.balance);\n      });\n\n      return importes;\n    }\n\n    return [];\n  }\n\n  async loadHistoricDetails(row: any): Promise<void> {\n    this.loadingDetail = true;\n    this.itemDetail = [];\n\n    const source$ = this._diarioService.getConceptosMovimHistorico(row.conceptId);\n\n    try {\n      const data = await firstValueFrom(source$);\n\n      this.itemDetail = data;\n      this.loadingDetail = false;\n\n    } catch (error) {\n      this.loading = false;\n      this._helperService.showSnackBarError(this.snackBar, this._helperService.getErrorMessage(error));\n    }\n  }\n\n  showOpenSaldo() {\n    const saldos: ISaldoItem[] = [];\n\n    const saldoItemHistorico: ISaldoItem = {\n      title: this.translate.instant('historical.historical'),\n      icon: 'blur_linear',\n      ingresos: this.getIngresos(),\n      egresos: this.getEgresos(),\n      concept: 'historico',\n      date: null\n    };\n    saldos.push(saldoItemHistorico);\n\n    this.saldoAbierto.open(SaldoAbiertoComponent, { width: '500px', data: {saldos} });\n  }\n\n}\n","<div class=\"loading\" *ngIf=\"loading\">\n  <mat-spinner diameter=\"70\" strokeWidth=\"5\"></mat-spinner>\n</div>\n\n<div *ngIf=\"!loading\">\n  <div class=\"header\">\n    <div class=\"column saldos\">\n      <app-saldo class=\"saldos\" [titulo]=\"this.historicalBalanceTitle\" [saldo]=\"saldoActual\" (saldoClicked)=\"showOpenSaldo()\"></app-saldo>\n    </div>\n  </div>\n\n  <div class=\"tableContent\">\n    <mat-accordion class=\"conceptos-table\">\n      <mat-expansion-panel *ngFor=\"let ct of conceptosTotales\" (opened)=\"loadHistoricDetails(ct)\">\n        <mat-expansion-panel-header>\n          <mat-panel-title>\n            {{ct.description}}\n          </mat-panel-title>\n          <mat-panel-description [class.importeNegativo]=\"ct.balance < 0\">\n            {{ct.balance | currency:this._userService.userCurrency}}\n          </mat-panel-description>\n        </mat-expansion-panel-header>\n\n        <mat-spinner class=\"loading\" *ngIf=\"loadingDetail\"></mat-spinner>\n        <mat-list *ngIf=\"!loadingDetail\">\n          <mat-list-item *ngFor=\"let detail of itemDetail\">\n            <div matLine>\n              <p class=\"itemDescription\">{{detail.year}}</p>\n              <p class=\"itemAmount\" [class.importeNegativo]=\"detail.balance < 0\">{{detail.balance | currency:this._userService.userCurrency}}</p>\n              </div>\n          </mat-list-item>\n        </mat-list>\n\n      </mat-expansion-panel>\n    </mat-accordion>\n</div>\n\n","import { HistoricoComponent } from '../../_components/historico/historico.component';\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nconst routes: Routes = [\n  { path: '', component: HistoricoComponent }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class HistoricoRoutingModule { }\n","import { HistoricoComponent } from '../../_components/historico/historico.component';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { HistoricoRoutingModule } from './historico-routing.module';\nimport { SharedModule } from '../shared/shared.module';\nimport { TranslateModule } from '@ngx-translate/core';\n\n\n@NgModule({\n  declarations: [HistoricoComponent],\n  imports: [\n    CommonModule,\n    HistoricoRoutingModule,\n    SharedModule,\n    TranslateModule\n  ]\n})\nexport class HistoricoModule { }\n"],"names":["firstValueFrom","SaldoAbiertoComponent","i0","ctx_r8","ctx_r10","ctx_r1","HistoricoComponent","constructor","_diarioService","_userService","calculationService","snackBar","saldoAbierto","translate","_helperService","historicalBalanceTitle","instant","ngOnInit","getData","getIngresos","convertToNumberArray","conceptosTotales","getEgresos","loading","source$","getConceptosTotalHistorico","data","saldoActual","error","showSnackBarError","getErrorMessage","dataIn","undefined","importes","forEach","value","push","balance","loadHistoricDetails","row","loadingDetail","itemDetail","getConceptosMovimHistorico","conceptId","showOpenSaldo","saldos","saldoItemHistorico","title","icon","ingresos","egresos","concept","date","open","width","selectors","decls","vars","consts","template"],"sourceRoot":"webpack:///"}
"use strict";(self.webpackChunkmoneyguard=self.webpackChunkmoneyguard||[]).push([[809],{7809:(ut,T,a)=>{a.r(T),a.d(T,{DiarioModule:()=>st});var g=a(9808),D=a(1787),A=a(5861),l=a(3075),b=a(1159),f=a(8966),S=a(3905),t=a(5e3),N=a(4952),_=a(232),M=a(7261),w=a(3441),C=a(4218),y=a(7322),O=a(7531);let Y=(()=>{class n{constructor(e,o){this.el=e,this.locale=o,this.regexEn=new RegExp(/^\d*\.?\d{0,2}$/g),this.regexEs=new RegExp(/^\d*\,?\d{0,2}$/g),this.specialKeys=["Enter","Backspace","Tab","End","Home","-","ArrowLeft","ArrowRight","Del","Delete"]}onKeyDown(e){if(-1!==this.specialKeys.indexOf(e.key))return;const o=e.key,i=this.el.nativeElement.value,s=this.el.nativeElement.selectionStart,c=[i.slice(0,s),"Decimal"===o?this.whatDecimalSeparator():o,i.slice(s)].join("");if(","===this.whatDecimalSeparator()){if(c&&!String(c).match(this.regexEs)){if("."!==o||-1!==this.el.nativeElement.value.indexOf(","))return void e.preventDefault();this.validateFields(e)}}else if(c&&!String(c).match(this.regexEn))return void e.preventDefault()}validateFields(e){setTimeout(()=>{this.el.nativeElement.value=this.el.nativeElement.value.replace(".",","),e.preventDefault()},10)}whatDecimalSeparator(){return 1.1.toLocaleString(this.locale).substring(1,2)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(t.SBq),t.Y36(t.soG))},n.\u0275dir=t.lG2({type:n,selectors:[["","appTwoDigitDecimaNumber",""]],hostBindings:function(e,o){1&e&&t.NdJ("keydown",function(s){return o.onKeyDown(s)})}}),n})();var E=a(9814),Z=a(6688),P=a(9224),J=a(7423),I=a(773),F=a(3874);function R(n,r){1&n&&t._UZ(0,"mat-spinner",19),2&n&&t.Q6J("diameter",20)}function k(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"mat-chip",20),t.NdJ("removed",function(){const s=t.CHM(e).$implicit;return t.oxw().removeTag(s)}),t._uU(1),t.TgZ(2,"mat-icon",21),t._uU(3,"cancel"),t.qZA(),t.qZA()}if(2&n){const e=r.$implicit;t.Q6J("removable",!0),t.xp6(1),t.hij(" ",e," ")}}let B=(()=>{class n{constructor(e,o,i,s,c,p,h,m){this.fb=e,this.formating=o,this._conceptosDiarioService=i,this.snackBar=s,this._helperService=c,this.translate=p,this.dialogRef=h,this.data=m,this.loading=!1,this.separatorKeysCodes=[b.K5,b.OC],this.tags=[]}ngOnInit(){this.form=this.fb.group({importeFormControl:[this.formating.FormatNumber(this.data.concepto.ammount,!0,!1),[l.kI.required]],debitoCreditoControl:"true"===this.isCredito().toString()?"1":"0"}),this.tags=this.data.concepto.tags}onCancel(){this.dialogRef.close()}onSave(){var e=this;return(0,A.Z)(function*(){e.loading=!0;const o=e.data.concepto.transactionDate.split("-"),i=new Date(parseInt(o[0]),parseInt(o[1])-1,parseInt(o[2])),s=parseFloat(e.form.value.importeFormControl.toString().replace(",",".")),c=e._conceptosDiarioService.setConceptoImporte(i,"1"===e.form.value.debitoCreditoControl?s:-1*s,e.data.concepto.conceptId,e.tags);try{yield(0,S.z)(c),e.data.concepto.ammount="1"===e.form.value.debitoCreditoControl||0===e.form.value.importeFormControl?s:-1*s,e.data.concepto.credit=e.form.value.debitoCreditoControl,e.dialogRef.close(e.data.concepto)}catch(p){e.loading=!1,e._helperService.showSnackBarError(e.snackBar,e._helperService.getErrorMessage(p))}})()}isCredito(){return 0===this.data.concepto.ammount?this.data.concepto.credit:this.data.concepto.ammount>0}removeTag(e){const o=this.tags.indexOf(e);o>=0&&this.tags.splice(o,1)}addTag(e){const o=e.input,i=e.value;this.tags.filter(s=>s.toLowerCase()===i.toLowerCase()).length<=0&&(i||"").trim()&&this.tags.push(i),o&&(o.value="")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(l.qu),t.Y36(N.Z),t.Y36(_.C),t.Y36(M.ux),t.Y36(w.W),t.Y36(C.sK),t.Y36(f.so),t.Y36(f.WI))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-diario-enter"]],decls:36,vars:25,consts:[[1,"title"],["mat-dialog-title",""],[1,"spinner"],["class","spinner",3,"diameter",4,"ngIf"],["novalidate","",1,"full-width-form",3,"formGroup","ngSubmit"],["matInput","","type","number","formControlName","importeFormControl","appTwoDigitDecimaNumber","","autocomplete","off",1,"importe",3,"placeholder","focus"],["importeInput",""],["formControlName","debitoCreditoControl"],["value","0",1,"debito"],["value","1",1,"credito"],[1,"tags-chip-list"],["chipList",""],[3,"removable","removed",4,"ngFor","ngForOf"],[3,"placeholder","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputTokenEnd"],[1,"buttons-section"],[1,"cancel-button"],["mat-raised-button","","type","button",3,"click"],[1,"save-button"],["mat-raised-button","","type","submit","color","primary",3,"disabled"],[1,"spinner",3,"diameter"],[3,"removable","removed"],["matChipRemove",""]],template:function(e,o){if(1&e){const i=t.EpF();t.TgZ(0,"div",0),t.TgZ(1,"h2",1),t._uU(2),t.qZA(),t.qZA(),t.TgZ(3,"div",2),t.YNc(4,R,1,1,"mat-spinner",3),t.qZA(),t.TgZ(5,"mat-dialog-content"),t.TgZ(6,"form",4),t.NdJ("ngSubmit",function(){return o.onSave()}),t.TgZ(7,"div"),t.TgZ(8,"mat-form-field"),t.TgZ(9,"input",5,6),t.NdJ("focus",function(){return t.CHM(i),t.MAs(10).select()}),t.ALo(11,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(12,"div"),t.TgZ(13,"mat-radio-group",7),t.TgZ(14,"mat-radio-button",8),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"mat-radio-button",9),t._uU(18),t.ALo(19,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(20,"mat-form-field",10),t.TgZ(21,"mat-chip-list",null,11),t.YNc(23,k,4,2,"mat-chip",12),t.TgZ(24,"input",13),t.NdJ("matChipInputTokenEnd",function(c){return o.addTag(c)}),t.ALo(25,"translate"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(26,"div",14),t.TgZ(27,"mat-card-actions"),t.TgZ(28,"div",15),t.TgZ(29,"button",16),t.NdJ("click",function(){return o.onCancel()}),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.qZA(),t.TgZ(32,"div",17),t.TgZ(33,"button",18),t._uU(34),t.ALo(35,"translate"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&e){const i=t.MAs(22);t.xp6(2),t.Oqu(o.data.concepto.description),t.xp6(2),t.Q6J("ngIf",o.loading),t.xp6(2),t.Q6J("formGroup",o.form),t.xp6(3),t.s9C("placeholder",t.lcZ(11,13,"dailyScreen.amount")),t.xp6(6),t.Oqu(t.lcZ(16,15,"concept.debit")),t.xp6(3),t.Oqu(t.lcZ(19,17,"concept.credit")),t.xp6(5),t.Q6J("ngForOf",o.tags),t.xp6(1),t.s9C("placeholder",t.lcZ(25,19,"dailyScreen.tags")),t.Q6J("matChipInputFor",i)("matChipInputSeparatorKeyCodes",o.separatorKeysCodes),t.xp6(6),t.Oqu(t.lcZ(31,21,"button.cancel")),t.xp6(3),t.Q6J("disabled",!o.form.valid||o.loading),t.xp6(1),t.Oqu(t.lcZ(35,23,"button.ok"))}},directives:[f.uh,g.O5,f.xY,l._Y,l.JL,l.sg,y.KE,O.Nt,l.wV,l.Fj,l.JJ,l.u,Y,E.VQ,E.U0,Z.qn,g.sg,Z.oH,P.hq,J.lW,I.$g,Z.HS,F.Hw,Z.qH],pipes:[C.X$],styles:[".cancel-button[_ngcontent-%COMP%]{float:left;text-align:left}.save-button[_ngcontent-%COMP%]{float:right;text-align:center}.buttons-section[_ngcontent-%COMP%]{padding-top:10px;padding-bottom:40px}.importe[_ngcontent-%COMP%]{text-align:right}.mat-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:50px}.title[_ngcontent-%COMP%]{float:left;text-align:left;width:90%}.spinner[_ngcontent-%COMP%]{float:right;text-align:right}.debito[_ngcontent-%COMP%]{color:red}  .debito.mat-radio-button.mat-accent .mat-radio-ripple .mat-ripple-element{background-color:red!important}  .debito.mat-radio-button.mat-accent .mat-radio-inner-circle{background-color:red!important}  .debito.mat-radio-button.mat-accent.mat-radio-checked .mat-radio-outer-circle{border-color:red!important}.credito[_ngcontent-%COMP%]{color:#000}  .credito.mat-radio-button.mat-accent .mat-radio-ripple .mat-ripple-element{background-color:#000!important}  .credito.mat-radio-button.mat-accent .mat-radio-inner-circle{background-color:#000!important}  .credito.mat-radio-button.mat-accent.mat-radio-checked .mat-radio-outer-circle{border-color:#000!important}.tags-chip-list[_ngcontent-%COMP%]{width:100%;padding-top:20px}"]}),n})();var U=a(8982),H=a(9841),L=a(4004),v=a(263),Q=a(4832),q=a(3484),$=a(9122),K=a(4455),x=a(6856),j=a(2181),d=a(2075);function z(n,r){1&n&&(t.TgZ(0,"div",2),t._UZ(1,"mat-spinner",3),t.qZA())}function G(n,r){1&n&&(t.TgZ(0,"div",2),t._UZ(1,"mat-spinner",3),t.qZA())}function W(n,r){1&n&&(t.TgZ(0,"th",22),t._uU(1,"Concepto"),t.qZA())}function X(n,r){if(1&n&&(t.TgZ(0,"td",23),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.xp6(1),t.hij(" ",e.description," ")}}function V(n,r){1&n&&(t.TgZ(0,"th",22),t._uU(1,"Importe"),t.qZA())}function tt(n,r){if(1&n&&(t.TgZ(0,"td",24),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&n){const e=r.$implicit,o=t.oxw(2);t.ekj("importeNegativo",e.ammount<0||0===e.credit),t.xp6(1),t.hij(" ",t.xi3(2,3,e.ammount,o._userService.userCurrency)," ")}}function et(n,r){1&n&&t._UZ(0,"tr",25)}function ot(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"tr",26),t.NdJ("click",function(){const s=t.CHM(e).$implicit;return t.oxw(2).openConcepto(s)}),t.qZA()}}function nt(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"div",4),t.TgZ(2,"div",5),t.TgZ(3,"mat-form-field",6),t.TgZ(4,"input",7),t.NdJ("click",function(){return t.CHM(e),t.MAs(8).open()})("dateChange",function(i){return t.CHM(e),t.oxw().changeDate("change",i)}),t.ALo(5,"translate"),t.qZA(),t._UZ(6,"mat-datepicker-toggle",8),t._UZ(7,"mat-datepicker",9,10),t.qZA(),t.qZA(),t.TgZ(9,"div",11),t.TgZ(10,"app-saldo",12),t.NdJ("saldoClicked",function(){return t.CHM(e),t.oxw().showOpenSaldo()}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(11,"div",13),t.TgZ(12,"table",14),t.ynx(13,15),t.YNc(14,W,2,0,"th",16),t.YNc(15,X,2,1,"td",17),t.BQk(),t.ynx(16,18),t.YNc(17,V,2,0,"th",16),t.YNc(18,tt,3,6,"td",19),t.BQk(),t.YNc(19,et,1,0,"tr",20),t.YNc(20,ot,1,0,"tr",21),t.qZA(),t.qZA(),t.qZA()}if(2&n){const e=t.MAs(8),o=t.oxw();t.xp6(4),t.s9C("placeholder",t.lcZ(5,10,"dailyScreen.date")),t.Q6J("matDatepicker",e)("formControl",o.currentDate),t.xp6(2),t.Q6J("for",e),t.xp6(1),t.Q6J("startAt",o.currentDate),t.xp6(3),t.Q6J("titulo",o.dailyBalanceTitle)("saldo",o.saldoDiario),t.xp6(2),t.Q6J("dataSource",o.conceptos),t.xp6(7),t.Q6J("matHeaderRowDef",o.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",o.displayedColumns)}}const at=[{path:":day",component:(()=>{class n{constructor(e,o,i,s,c,p,h,m,u,ct,lt,dt,mt,pt){this._conceptosDiarioService=e,this._userService=o,this._helperService=i,this.datePipe=s,this.snackBar=c,this._sumaryMonthService=p,this._sumaryAnioService=h,this.calculationService=m,this.activeRoute=u,this.router=ct,this.location=lt,this.enterDiario=dt,this.translate=mt,this.saldoAbierto=pt,this.loading=!1,this.loadingPopup=!1,this.displayedColumns=["descripcion","importe"],this.saldoDiario=0}get dailyBalanceTitle(){return this.translate.instant("dailyScreen.dailyBalance")}ngOnInit(){this.activeRoute.params.subscribe(e=>{const o=this.getDateFromUrl();o.setMonth(o.getMonth()-1),this.currentDate=new l.NI(o),this.getData()})}changeDate(e,o){const i=this.datePipe.transform(o.value,"yyyy-MM-dd");this.router.navigate([v.r.DASHBOARD,v.r.DIARIO,i])}getData(){var e=this;return(0,A.Z)(function*(){e.loading=!0;const o=e._conceptosDiarioService.getConceptosImportes(e.currentDate.value);try{const i=yield(0,S.z)(o);e.conceptos=i,e.saldoDiario=e.getIngresos()-e.getEgresos(),e.loading=!1}catch(i){e.loading=!1,e._helperService.showSnackBarError(e.snackBar,e._helperService.getErrorMessage(i))}})()}openConcepto(e){this.enterDiario.open(B,{data:{concepto:e},width:"300px"}).afterClosed().subscribe(i=>{this.saldoDiario=this.getIngresos()-this.getEgresos()})}getIngresos(){return this.calculationService.getIngresos(this.convertToNumberArray(this.conceptos))}getEgresos(){return this.calculationService.getEgresos(this.convertToNumberArray(this.conceptos))}showOpenSaldo(){this.loadingPopup=!0;const e=[],o={title:""+this._helperService.toCamelCase(this.datePipe.transform(new Date(this.currentDate.value),"mediumDate")),icon:"today",ingresos:this.getIngresos(),egresos:this.getEgresos(),concept:"diario",date:new Date(this.currentDate.value)};e.push(o);const i=this._sumaryMonthService.getSumary(this.currentDate.value),s=this._sumaryAnioService.getSumary(this.currentDate.value);try{(0,H.a)({mensual:i,anual:s}).pipe((0,L.U)(c=>{const h=c.anual,m={};return m.mensual=c.mensual,m.anual=h,m})).subscribe(c=>{const p={title:""+this._helperService.toCamelCase(this.datePipe.transform(new Date(this.currentDate.value),"LLLL yyyy")),icon:"calendar_today",ingresos:c.mensual.in,egresos:c.mensual.out,concept:"mensual",date:new Date(this.currentDate.value)};e.push(p);const h={title:this.translate.instant("dailyScreen.year")+" "+this.datePipe.transform(new Date(this.currentDate.value),"yyyy"),icon:"airplay",ingresos:c.anual.in,egresos:c.anual.out,concept:"mensual",date:new Date(this.currentDate.value)};e.push(h),this.loadingPopup=!1;const m=this.saldoAbierto.open(U.G,{width:"500px",data:{saldos:e}});m.componentInstance.itemPushed.subscribe(u=>{null===u.date||u.concept===v.r.DIARIO||(m.close(),this.router.navigate(u.concept===v.r.ANUAL?[v.r.DASHBOARD,u.concept,u.date.getFullYear(),"none"]:[v.r.DASHBOARD,u.concept,u.date.toISOString(),"none"]))})})}catch(c){this.loading=!1,this._helperService.showSnackBarError(this.snackBar,this._helperService.getErrorMessage(c))}}convertToNumberArray(e){const o=[];return e.forEach(function(i){o.push(i.ammount)}),o}getDateFromUrl(){var e;const o=null===(e=this.activeRoute.snapshot.paramMap.get("day"))||void 0===e?void 0:e.split("-");if(null==o)throw"DateUrl is NULL";return new Date(Number(o[0]),Number(o[1]),Number(o[2]))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(_.C),t.Y36(Q.f),t.Y36(w.W),t.Y36(g.uU),t.Y36(M.ux),t.Y36(q.Q),t.Y36($.P),t.Y36(K.H),t.Y36(D.gz),t.Y36(D.F0),t.Y36(g.Ye),t.Y36(f.uw),t.Y36(C.sK),t.Y36(f.uw))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-diario"]],decls:3,vars:3,consts:[["class","loading",4,"ngIf"],[4,"ngIf"],[1,"loading"],["diameter","70","strokeWidth","5"],[1,"header"],[1,"column"],[1,"datePicker"],["matInput","","readonly","",3,"matDatepicker","placeholder","formControl","click","dateChange"],["matSuffix","",3,"for"],[3,"startAt"],["picker",""],[1,"column","saldos"],[3,"titulo","saldo","saldoClicked"],[1,"tableContent"],["mat-table","",1,"mat-elevation-z8","conceptos-table",3,"dataSource"],["matColumnDef","descripcion"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","importe"],["mat-cell","","class","importe",3,"importeNegativo",4,"matCellDef"],["mat-header-row","","style","display: none;",4,"matHeaderRowDef"],["mat-row","",3,"click",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"importe"],["mat-header-row","",2,"display","none"],["mat-row","",3,"click"]],template:function(e,o){1&e&&(t.YNc(0,z,2,0,"div",0),t.YNc(1,G,2,0,"div",0),t.YNc(2,nt,21,12,"div",1)),2&e&&(t.Q6J("ngIf",o.loading),t.xp6(1),t.Q6J("ngIf",o.loadingPopup),t.xp6(1),t.Q6J("ngIf",!o.loading))},directives:[g.O5,I.$g,y.KE,O.Nt,x.hl,l.Fj,l.JJ,l.oH,x.nW,y.R9,x.Mq,j.q,d.BZ,d.w1,d.fO,d.Dz,d.as,d.nj,d.ge,d.ev,d.XQ,d.Gk],pipes:[C.X$,g.H9],styles:[".conceptos-table[_ngcontent-%COMP%]{width:60%}.mat-row[_ngcontent-%COMP%]:nth-child(even){background-color:#f3f4fc}.importe[_ngcontent-%COMP%]{text-align:right}.importeNegativo[_ngcontent-%COMP%]{color:red}.datePicker[_ngcontent-%COMP%]{width:150px;margin-left:5px;margin-top:10px;text-align:center}.tableContent[_ngcontent-%COMP%]{display:flex;justify-content:center;position:fixed;width:100%;height:84%;top:16%;overflow-y:scroll;max-block-size:-webkit-fill-available}.header[_ngcontent-%COMP%]{display:table;margin:0 auto;clear:both;width:60%;text-align:center}.column[_ngcontent-%COMP%]{float:left;width:50%}.saldos[_ngcontent-%COMP%]{margin-top:15px}@media only screen and (max-width: 600px){.conceptos-table[_ngcontent-%COMP%], .header[_ngcontent-%COMP%]{width:100%}}"]}),n})()}];let it=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[D.Bz.forChild(at)],D.Bz]}),n})();var rt=a(7612);let st=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[g.ez,it,rt.m,C.aw]]}),n})()}}]);